@model IEnumerable<Car_Rental_Management.Models.Booking>

<div class="container mt-4">
    <h2 class="mb-4">📑 All Bookings</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-warning text-center">
            <p>No bookings have been made yet.</p>
        </div>
    }
    else
    {
        <table class="table table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Booking ID</th>
                    <th>Customer</th>
                    <th>Car</th>
                    <th>Pickup</th>
                    <th>Return</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Driver</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var b in Model)
                {
                    <tr>
                        <td>@b.BookingID</td>
                        <td>@b.Customer?.Username</td>
                        <td>@b.Car.CarModel.Brand @b.Car.CarModel.ModelName</td>
                        <td>@b.PickupDate.ToShortDateString()</td>
                        <td>@b.ReturnDate.ToShortDateString()</td>
                        <td>@b.Location?.Address</td>
                        <td>@b.Status</td>
                        <td>@(b.PaymentMethod ?? "Pending")</td>
                        <td>
                            <button type="button" class="btn btn-info btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#driverModal-@b.BookingID">
                                View
                            </button>

                            <!-- Modal -->
                            <div class="modal fade" id="driverModal-@b.BookingID" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Driver Details</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            @if (b.NeedDriver)
                                            {
                                                @if (b.DriverBookings != null && b.DriverBookings.Any())
                                                {
                                                    var driver = b.DriverBookings.First().Driver;
                                                    <p><strong>Our Driver Assigned</strong></p>
                                                    <p>Name: @driver.FullName</p>
                                                    <p>Phone: @driver.PhoneNo</p>
                                                    <p>License: @driver.LicenseNo</p>
                                                }
                                                else if (!string.IsNullOrEmpty(b.AltDriverName))
                                                {
                                                    <p><strong>Customer's Alternate Driver</strong></p>
                                                    <p>Name: @b.AltDriverName</p>
                                                    <p>IC: @b.AltDriverIC</p>
                                                    <p>License: @b.AltDriverLicenseNo</p>
                                                }
                                                else
                                                {
                                                    <p>No driver assigned yet</p>
                                                }
                                            }
                                            else
                                            {
                                                <p>No driver requested</p>
                                            }
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>
